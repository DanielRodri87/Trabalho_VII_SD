# ğŸš€ Testes de Performance - Spring PetClinic Microservices

<div align="center">

![Performance Testing](https://img.shields.io/badge/Testing-Performance-blue?style=for-the-badge)
![Locust](https://img.shields.io/badge/Locust-Load_Testing-green?style=for-the-badge)
![Docker](https://img.shields.io/badge/Docker-Containerized-2496ED?style=for-the-badge&logo=docker&logoColor=white)
![Python](https://img.shields.io/badge/Python-Analysis-3776AB?style=for-the-badge&logo=python&logoColor=white)

**AnÃ¡lise de carga e performance para arquitetura de microserviÃ§os**

[VisÃ£o Geral](#-visÃ£o-geral) â€¢
[InstalaÃ§Ã£o](#-instalaÃ§Ã£o) â€¢
[ExecuÃ§Ã£o](#-execuÃ§Ã£o) â€¢
[Resultados](#-resultados) â€¢
[Arquitetura](#-arquitetura)

</div>

---

[![YouTube](https://img.shields.io/badge/YouTube-DemonstraÃ§Ã£o-red?style=for-the-badge&logo=youtube&logoColor=white)](https://youtu.be/PGOzffyX7eQ?si=H35gxCF3-zcO3oPc)


## ğŸ“‹ VisÃ£o Geral

Este projeto implementa testes de carga automatizados para o **Spring PetClinic Microservices**, avaliando o comportamento do sistema sob diferentes cenÃ¡rios de stress. Utilizando **Locust** para simulaÃ§Ã£o de usuÃ¡rios e **Docker** para isolamento de ambiente, garantimos resultados consistentes e reproduzÃ­veis.

### ğŸ¯ Objetivos

- Avaliar latÃªncia e throughput em condiÃ§Ãµes variadas
- Identificar gargalos de performance
- Medir taxas de erro sob alta carga
- Gerar mÃ©tricas consolidadas para anÃ¡lise

---

## ğŸ—ï¸ Arquitetura

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Locust    â”‚  Simula usuÃ¡rios concorrentes
â”‚  (Cliente)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Gateway â”‚  Porta 8080
â”‚  (Spring)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â–¼          â–¼          â–¼          â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚Customerâ”‚ â”‚  Vets  â”‚ â”‚ Visits â”‚ â”‚Discoveryâ”‚
  â”‚Service â”‚ â”‚Service â”‚ â”‚Service â”‚ â”‚(Eureka)â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“¡ Endpoints Testados

| MÃ©todo | Endpoint | Peso | DescriÃ§Ã£o |
|--------|----------|------|-----------|
| `GET` | `/api/customer/owners` | 4 | Lista todos os proprietÃ¡rios |
| `GET` | `/api/customer/owners/{id}` | 3 | Busca proprietÃ¡rio por ID |
| `GET` | `/api/vet/vets` | 2 | Lista todos os veterinÃ¡rios |
| `POST` | `/api/customer/owners` | 1 | Cria novo proprietÃ¡rio |

---

## ğŸ”§ InstalaÃ§Ã£o

### PrÃ©-requisitos

- **Docker** & **Docker Compose**
- **Python 3.8+**
- **Maven** (para build do projeto)
- **Locust**

### Setup RÃ¡pido

```bash
# 1. Clone o repositÃ³rio
git clone <seu-repositorio>
cd <diretorio-projeto>

# 2. Instale dependÃªncias Python
pip install -r req.txt
pip install locust

# 3. Build do projeto Spring Boot
./mvnw clean install -DskipTests

# 4. Suba os containers Docker
docker-compose -f docker-compose.yml up -d

# 5. Aguarde estabilizaÃ§Ã£o (2-3 minutos)
sleep 120
```

### ğŸ“¦ DependÃªncias Python

```
pandas
numpy
matplotlib
seaborn
locust
tabulate
```

---

## ğŸš€ ExecuÃ§Ã£o

### Executar Todos os CenÃ¡rios

O script automatizado executa **5 repetiÃ§Ãµes** de cada cenÃ¡rio com reinicializaÃ§Ã£o completa do ambiente:

```bash
chmod +x run_all_scenarios.sh
./run_all_scenarios.sh
```

> âš ï¸ **Nota**: O script solicitarÃ¡ senha `sudo` a cada reinicializaÃ§Ã£o do Docker (15 vezes no total).

### CenÃ¡rios de Teste

| CenÃ¡rio | UsuÃ¡rios | Ramp-up | DuraÃ§Ã£o | Objetivo |
|---------|----------|---------|---------|----------|
| **ğŸŸ¢ Leve** | 50 | 10/s | 10 min | OperaÃ§Ã£o normal |
| **ğŸŸ¡ Moderado** | 100 | 20/s | 10 min | Carga elevada |
| **ğŸ”´ Pico** | 200 | 40/s | 5 min | Stress mÃ¡ximo |

### ExecuÃ§Ã£o Manual

```bash
# CenÃ¡rio Leve
locust -f locustfile.py --headless -u 50 -r 10 --run-time 10m \
  --csv results/leve/run_1 --host http://localhost:8080

# CenÃ¡rio Moderado
locust -f locustfile.py --headless -u 100 -r 20 --run-time 10m \
  --csv results/medio/run_1 --host http://localhost:8080

# CenÃ¡rio Pico
locust -f locustfile.py --headless -u 200 -r 40 --run-time 5m \
  --csv results/pico/run_1 --host http://localhost:8080
```

---

## ğŸ“Š Resultados

### AnÃ¡lise Consolidada

ApÃ³s a execuÃ§Ã£o, gere o relatÃ³rio consolidado:

```bash
python analyze_results.py
```

### MÃ©tricas Obtidas

| CenÃ¡rio | UsuÃ¡rios | LatÃªncia MÃ©dia (ms) | LatÃªncia MÃ¡xima (ms) | Req/s | Taxa de Erro (%) |
|---------|----------|---------------------|----------------------|-------|------------------|
| **Leve** | 50 | 19.74 | 1,463.74 | 24.76 | 0.00 |
| **Moderado** | 100 | 50.20 | 10,082.75 | 48.75 | 53.99 |
| **Pico** | 200 | 81.81 | 10,174.99 | 96.09 | 68.87 |

### ğŸ“ˆ InterpretaÃ§Ã£o

- âœ… **CenÃ¡rio Leve**: Sistema estÃ¡vel, sem erros
- âš ï¸ **CenÃ¡rio Moderado**: DegradaÃ§Ã£o significativa com 54% de falhas
- âŒ **CenÃ¡rio Pico**: Sistema saturado com 69% de taxa de erro

### Estrutura de Arquivos

```
results/
â”œâ”€â”€ leve/
â”‚   â”œâ”€â”€ leve_stats_run_1_stats.csv
â”‚   â”œâ”€â”€ leve_stats_run_2_stats.csv
â”‚   â””â”€â”€ ...
â”œâ”€â”€ medio/
â”‚   â”œâ”€â”€ medio_stats_run_1_stats.csv
â”‚   â””â”€â”€ ...
â””â”€â”€ pico/
    â”œâ”€â”€ pico_stats_run_1_stats.csv
    â””â”€â”€ ...

resultados_consolidados.csv  # RelatÃ³rio final
```

---

## ğŸ§ª Testes Manuais

### Criar ProprietÃ¡rios

```bash
curl -X POST http://localhost:8080/api/customer/owners \
  -H "Content-Type: application/json" \
  -d '{
    "firstName": "Daniel",
    "lastName": "Rodrigues",
    "address": "Avenida Sul 3101",
    "city": "Picos",
    "telephone": "999999999"
  }'
```

### Consultar Dados

```bash
# Listar proprietÃ¡rios
curl http://localhost:8080/api/customer/owners

# Listar veterinÃ¡rios
curl http://localhost:8080/api/vet/vets

# Listar visitas
curl http://localhost:8080/api/visit/visits
```

---

## ğŸ” Troubleshooting

### Containers nÃ£o inicializam

```bash
# Verificar status
docker ps

# Verificar logs
docker logs <container-name>

# Reiniciar ambiente
cd spring-petclinic-microservices
sudo docker-compose down
sudo docker-compose up -d
```

### Alta taxa de erros

- Aumente o tempo de estabilizaÃ§Ã£o no script (padrÃ£o: 120s)
- Verifique recursos do sistema (CPU, RAM)
- Confirme que todos os serviÃ§os estÃ£o registrados no Eureka

### ConexÃ£o recusada

```bash
# Verifique se o API Gateway estÃ¡ respondendo
curl -I http://localhost:8080/api/customer/owners

# Aguarde mais tempo para inicializaÃ§Ã£o
sleep 60
```

---

## ğŸ› ï¸ CustomizaÃ§Ã£o

### Adicionar Novos Endpoints

Edite `locustfile.py`:

```python
@task(2)
def get_pets(self):
    owner_id = random.randint(1, 200)
    self.client.get(f"/api/customer/owners/{owner_id}/pets", 
                    name="GET /owners/[id]/pets")
```

### Modificar ParÃ¢metros de Carga

Edite `run_all_scenarios.sh`:

```bash
# Exemplo: 150 usuÃ¡rios, ramp-up 30/s, duraÃ§Ã£o 15 minutos
locust -f $LOCUST_FILE --headless \
  -u 150 -r 30 --run-time 15m \
  --csv "results/custom/run_$i" \
  --host $HOST
```

---

## ğŸ“ Notas Importantes

1. **Tempo de ExecuÃ§Ã£o**: O script completo leva ~3-4 horas (15 reinicializaÃ§Ãµes + testes)
2. **Recursos**: Recomendado 8GB RAM e 4 CPUs para testes de pico
3. **ConsistÃªncia**: Cada teste reinicia o Docker para garantir estado limpo
4. **AnÃ¡lise**: Use `analyze_results.py` apenas apÃ³s conclusÃ£o de todos os testes

---

## ğŸ“„ LicenÃ§a

Este projeto segue a licenÃ§a do Spring PetClinic original.

---

## ğŸ‘¥ ContribuiÃ§Ã£o

Desenvolvido para anÃ¡lise de performance de arquiteturas de microserviÃ§os baseadas em Spring Cloud.
Daniel Rodrigues
Rita Rodrigues
Walison Weudes

**LocalizaÃ§Ã£o**: Picos, PiauÃ­, BR

---

<div align="center">

**[â¬† Voltar ao topo](#-testes-de-performance---spring-petclinic-microservices)**

</div>